import{_ as t,r as o,o as p,c as i,b as n,d as s,e,a as c}from"./app-06cd0c15.js";const l={},u=c(`<h1 id="modify" tabindex="-1"><a class="header-anchor" href="#modify" aria-hidden="true">#</a> Modify</h1><p>Android 源码编辑</p><ul><li>自启动</li><li>白名单</li><li>应用内置</li><li>隐藏导航栏</li></ul><h2 id="_0116" tabindex="-1"><a class="header-anchor" href="#_0116" aria-hidden="true">#</a> 0116</h2><h3 id="修改内容" tabindex="-1"><a class="header-anchor" href="#修改内容" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加启动代码到<code>frameworks/base/services/java/com/android/server/SystemServer.java</code>的<code>startOtherServices()</code>方法中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 系统服务启动完成后，添加以下代码</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 第三方应用包名</span>
<span class="token class-name">PackageManager</span> pm <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add app to kiosk mod</span>
    <span class="token class-name">ActivityManager</span> am <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ActivityManager</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">ACTIVITY_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> isInLockTask <span class="token operator">=</span> am<span class="token punctuation">.</span><span class="token function">getLockTaskModeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">ActivityManager</span><span class="token punctuation">.</span><span class="token constant">LOCK_TASK_MODE_NONE</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInLockTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">startLockTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将应用添加到白名单<code>frameworks/base/core/res/res/values/config.xml</code>中添加</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lock_task_packages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>com.example.thirdpartyapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在<code>device\\rockchip\\rk356x\\rk3566_tspi\\rk3566_tspi.mk</code>中添加属性<code>persist.sys.def_launherpag</code><strong>rk3566_tspi.mk</strong></li></ol><div class="language-mk line-numbers-mode" data-ext="mk"><pre class="language-mk"><code>PRODUCT_PROPERTY_OVERRIDES += persist.sys.def_launherpag=dji.go.v5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>添加应用到<code>device\\rockchip\\rk356x\\rk3566_tspi\\preinstall\\</code> ,我就直接把应用<code>DJIFly.apk</code>丢进<code>preinstall</code>中</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DJIFly
 |-- DJIFly.apk
 |-- Android.mk
 |-- lib
Android.mk
preinstall.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android.mk</strong></p><div class="language-Android.mk line-numbers-mode" data-ext="Android.mk"><pre class="language-Android.mk"><code>include $(call all-subdir-makefiles)


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>preinstall.mk</strong></p><div class="language-preinstall.mk line-numbers-mode" data-ext="preinstall.mk"><pre class="language-preinstall.mk"><code>PRODUCT_PACKAGES += DJIFly

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>修改底部导航栏功能并隐藏</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><h3 id="编译结果" tabindex="-1"><a class="header-anchor" href="#编译结果" aria-hidden="true">#</a> 编译结果</h3><p>编译失败</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>warning: some JAR files in the classpath have the Kotlin Runtime library bundled into them. This may cause difficult to debug problems if there&#39;s a different version of the Kotlin Runtime library in the classpath. Consider removing these libraries from the classpath
out/soong/.intermediates/frameworks/base/packages/SettingsLib/SettingsLib/android_common/turbine-combined/SettingsLib.jar: warning: library has Kotlin runtime bundled into it
out/soong/.intermediates/prebuilts/tools/common/m2/kotlinx-coroutines-core/android_common/turbine-combined/kotlinx-coroutines-core.jar: warning: library has Kotlin runtime bundled into it
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/ControlsEditingActivity.kt:142:13: warning: variable &#39;rootView&#39; is never used
        val rootView = requireViewById&lt;ViewGroup&gt;(R.id.controls_management_root)
            ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/ControlsModel.kt:117:28: warning: parameter &#39;_a&#39; is never used
private fun nullIconGetter(_a: ComponentName, _b: String): Icon? = null
                           ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/ControlsModel.kt:117:47: warning: parameter &#39;_b&#39; is never used
private fun nullIconGetter(_a: ComponentName, _b: String): Icon? = null
                                              ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/FavoritesModel.kt:223:35: warning: &#39;getter for adapterPosition: Int&#39; is deprecated. Deprecated in Java
            onMoveItem(viewHolder.adapterPosition, target.adapterPosition)
                                  ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/FavoritesModel.kt:223:59: warning: &#39;getter for adapterPosition: Int&#39; is deprecated. Deprecated in Java
            onMoveItem(viewHolder.adapterPosition, target.adapterPosition)
                                                          ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/FavoritesModel.kt:231:28: warning: &#39;getter for adapterPosition: Int&#39; is deprecated. Deprecated in Java
            if (viewHolder.adapterPosition &lt; dividerPosition) {
                           ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/management/FavoritesModel.kt:243:27: warning: &#39;getter for adapterPosition: Int&#39; is deprecated. Deprecated in Java
            return target.adapterPosition &lt; dividerPosition
                          ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/ui/ControlViewHolder.kt:243:72: warning: unnecessary non-null assertion (!!) on a non-null receiver of type Behavior
        val behavior = if (existingBehavior == null || existingBehavior!!::class != clazz) {
                                                                       ^
frameworks/base/packages/SystemUI/src/com/android/systemui/controls/ui/ControlsUiControllerImpl.kt:200:33: warning: parameter &#39;items&#39; is never used
    private fun showSeedingView(items: List&lt;SelectionItem&gt;) {
                                ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataFilter.kt:96:37: warning: parameter &#39;id&#39; is never used
    internal fun handleUserSwitched(id: Int) {
                                    ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:496:62: warning: elvis operator (?:) always returns the left operand of non-nullable type Int
            MediaController.PlaybackInfo.PLAYBACK_TYPE_LOCAL ?: true
                                                             ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:497:89: warning: right operand of elvis operator (?:) is useless if it is null
        val isPlaying = mediaController.playbackState?.let { isPlayingState(it.state) } ?: null
                                                                                        ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:549:26: warning: parameter &#39;info&#39; is never used, could be renamed to _
                decoder, info, source -&gt; decoder.isMutableRequired = true
                         ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:549:32: warning: name shadowed: source
                decoder, info, source -&gt; decoder.isMutableRequired = true
                               ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:549:32: warning: parameter &#39;source&#39; is never used, could be renamed to _
                decoder, info, source -&gt; decoder.isMutableRequired = true
                               ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDataManager.kt:614:30: warning: unnecessary safe call on a non-null receiver of type MediaData?
            val pkg = removed?.packageName
                             ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDeviceManager.kt:72:35: warning: unnecessary safe call on a non-null receiver of type MediaDeviceManager.Entry?
        if (entry == null || entry?.token != data.token) {
                                  ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDeviceManager.kt:160:18: warning: parameter &#39;fd&#39; is never used
        fun dump(fd: FileDescriptor, pw: PrintWriter, args: Array&lt;String&gt;) {
                 ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaDeviceManager.kt:160:55: warning: parameter &#39;args&#39; is never used
        fun dump(fd: FileDescriptor, pw: PrintWriter, args: Array&lt;String&gt;) {
                                                      ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaResumeListener.kt:170:57: warning: unnecessary non-null assertion (!!) on a non-null receiver of type List&lt;ResolveInfo!&gt;
                        tryUpdateResumptionList(key, inf!!.get(0).componentInfo.componentName)
                                                        ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaSessionBasedFilter.kt:94:66: warning: the corresponding parameter in the supertype &#39;Listener&#39; is named &#39;data&#39;. This may cause problems when calling this function with named arguments.
    override fun onMediaDataLoaded(key: String, oldKey: String?, info: MediaData) {
                                                                 ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/MediaSessionBasedFilter.kt:126:83: warning: unnecessary safe call on a non-null receiver of type MediaController?
                Log.d(TAG, &quot;filtering key=$key local=\${info.token} remote=\${remote?.sessionToken}&quot;)
                                                                                  ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/SeekBarObserver.kt:64:22: warning: unnecessary safe call on a non-null receiver of type Int
        data.duration?.let {
                     ^
frameworks/base/packages/SystemUI/src/com/android/systemui/media/SeekBarViewModel.kt:224:39: warning: elvis operator (?:) always returns the left operand of non-nullable type Int
        val duration = _data.duration ?: -1
                                      ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/collection/NotifViewManager.kt:200:14: warning: parameter &#39;fd&#39; is never used
    fun dump(fd: FileDescriptor, pw: PrintWriter, args: Array&lt;String&gt;) {
             ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/collection/NotifViewManager.kt:200:34: warning: parameter &#39;pw&#39; is never used
    fun dump(fd: FileDescriptor, pw: PrintWriter, args: Array&lt;String&gt;) {
                                 ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/collection/NotifViewManager.kt:200:51: warning: parameter &#39;args&#39; is never used
    fun dump(fd: FileDescriptor, pw: PrintWriter, args: Array&lt;String&gt;) {
                                                  ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/collection/notifcollection/NotifEvent.kt:95:18: warning: &#39;onRankingUpdate(NotificationListenerService.RankingMap!): Unit&#39; is deprecated. Deprecated in Java
        listener.onRankingUpdate(rankingMap)
                 ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/people/PeopleNotificationIdentifier.kt:73:31: warning: name shadowed: type
                    when (val type = upperBound(type, extractPersonTypeInfo(sbn))) {
                              ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/row/PriorityOnboardingDialogController.kt:89:44: warning: unnecessary safe call on a non-null receiver of type NotificationConversationInfo.OnConversationSettingsClickListener
        onConversationSettingsClickListener?.onClick()
                                           ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/row/PriorityOnboardingDialogController.kt:176:22: warning: &#39;getColor(Int): Int&#39; is deprecated. Deprecated in Java
                    .getColor(com.android.internal.R.color.conversation_important_highlight)
                     ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/row/PriorityOnboardingDialogController.kt:184:17: warning: variable &#39;largeSize&#39; is never used
            val largeSize = baseSize + largeThickness * 2
                ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/ForegroundServiceSectionController.kt:74:9: warning: parameter &#39;key&#39; is never used
        key: String,
        ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/ForegroundServiceSectionController.kt:81:13: warning: variable &#39;isAppCancel&#39; is never used
        val isAppCancel = reason == REASON_APP_CANCEL || reason == REASON_APP_CANCEL_ALL
            ^
frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/notification/stack/NotificationSectionsManager.kt:137:75: warning: unchecked cast: View! to T
        val inflated = layoutInflater.inflate(layoutResId, parent, false) as T
                                                                          ^
frameworks/base/packages/SystemUI/src/com/android/systemui/util/RelativeTouchListener.kt:93:27: warning: &#39;constructor Handler()&#39; is deprecated. Deprecated in Java
    private val handler = Handler()
                          ^
frameworks/base/packages/SystemUI/src/com/android/systemui/util/magnetictarget/MagnetizedObject.kt:465:22: warning: &#39;vibrate(Long): Unit&#39; is deprecated. Deprecated in Java
            vibrator.vibrate(effect.toLong())
                     ^
14:20:26 ninja failed with: exit status 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误原因未知</p><h2 id="_0116v2" tabindex="-1"><a class="header-anchor" href="#_0116v2" aria-hidden="true">#</a> 0116v2</h2><h3 id="修改内容-1" tabindex="-1"><a class="header-anchor" href="#修改内容-1" aria-hidden="true">#</a> 修改内容</h3><ol><li>==0116 <ul><li>自启动</li></ul></li><li>修改位于<code>frameworks\\base\\services\\devicepolicy\\java\\com\\android\\server\\devicepolicy</code>的<code>DevicePolicyManagerService.java</code>，在<code>setLockTaskPackages</code>方法中添加如下代码 <ul><li>白名单</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> lockTaskPackages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>packages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lockTaskPackages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>

<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token function">getLockObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">enforceCanCallLockTaskLocked</span><span class="token punctuation">(</span>who<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> userHandle <span class="token operator">=</span> mInjector<span class="token punctuation">.</span><span class="token function">userHandleGetCallingUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ilee modify here --start</span>
    <span class="token function">setLockTaskPackagesLocked</span><span class="token punctuation">(</span>userHandle<span class="token punctuation">,</span> lockTaskPackages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ilee modify here --end</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>==0116</li><li>==0116</li><li>==0116</li></ol><h3 id="编译结果-1" tabindex="-1"><a class="header-anchor" href="#编译结果-1" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0116v3" tabindex="-1"><a class="header-anchor" href="#_0116v3" aria-hidden="true">#</a> 0116v3</h2><h3 id="修改内容-2" tabindex="-1"><a class="header-anchor" href="#修改内容-2" aria-hidden="true">#</a> 修改内容</h3><ol><li>==0116</li><li>修改位于<code>frameworks\\base\\services\\core\\java\\com\\android\\server\\wm</code>的<code>LockTaskController.java</code>，在<code>LockTaskController</code>方法中添加如下代码</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
mLockTaskPackages<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">UserHandle</span><span class="token punctuation">.</span><span class="token constant">USER_SYSTEM</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
        <span class="token string">&quot;dji.go.v5&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>==0116</li><li>==0116</li><li>==0116</li></ol><h3 id="编译结果-2" tabindex="-1"><a class="header-anchor" href="#编译结果-2" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0116v4" tabindex="-1"><a class="header-anchor" href="#_0116v4" aria-hidden="true">#</a> 0116v4</h2><p>failed</p><h3 id="修改内容-3" tabindex="-1"><a class="header-anchor" href="#修改内容-3" aria-hidden="true">#</a> 修改内容</h3><ol><li>修改来自<code>frameworks/base/packages/SystemUI/src/com/android/systemui</code>的<code>SystemUIService.java</code>文件 <ul><li>自启动 在构造函数中添加</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;appops set dji.go.v5 WRITE_SETTINGS allow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;appops set dji.go.v5 SYSTEM_ALERT_WINDOW allow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;appops set dji.go.v5 MANAGE_EXTERNAL_STORAGE allow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.CAMERA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.READ_PHONE_STATE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.WRITE_MEDIA_STORAGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.ACCESS_FINE_LOCATION&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.RECORD_AUDIO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.CALL_PHONE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.GET_ACCOUNTS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.READ_EXTERNAL_STORAGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.WRITE_EXTERNAL_STORAGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.READ_MEDIA_AUDIO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.READ_MEDIA_VIDEO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pm grant dji.go.v5 android.permission.READ_MEDIA_IMAGES&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeCMD</span><span class="token punctuation">(</span><span class="token string">&quot;su&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;am start -n dji.go.v5/com.dji.component.application.activity.DJIPureLaunchActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><ul><li>白名单</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><h3 id="编译结果-3" tabindex="-1"><a class="header-anchor" href="#编译结果-3" aria-hidden="true">#</a> 编译结果</h3><p>失败</p><h2 id="_0116v4-1" tabindex="-1"><a class="header-anchor" href="#_0116v4-1" aria-hidden="true">#</a> 0116v4</h2><h3 id="修改内容-4" tabindex="-1"><a class="header-anchor" href="#修改内容-4" aria-hidden="true">#</a> 修改内容</h3><ol><li>修改来自<code>frameworks/base/packages/SystemUI/src/com/android/systemui</code>的<code>SystemUIService.java</code>文件 <ul><li>自启动 在<code>onCreate</code>函数中添加</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
<span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 第三方应用包名</span>
<span class="token class-name">PackageManager</span> pm <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><ul><li>白名单</li></ul></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><h3 id="编译结果-4" tabindex="-1"><a class="header-anchor" href="#编译结果-4" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0117v2" tabindex="-1"><a class="header-anchor" href="#_0117v2" aria-hidden="true">#</a> 0117v2</h2><ol><li>内置应用 work</li><li>自启动 work</li></ol><h3 id="修改内容-5" tabindex="-1"><a class="header-anchor" href="#修改内容-5" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加启动代码到<code>frameworks/base/services/java/com/android/server/SystemServer.java</code>的<code>startOtherServices()</code>方法中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line 43</span>
<span class="token comment">// ilee modify here 1 line</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">BroadcastReceiver</span></span><span class="token punctuation">;</span>

<span class="token comment">// 系统服务启动完成后，添加以下代码</span>
<span class="token comment">// line:2247</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>

<span class="token comment">// line 2497</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">startKioskApp</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startKioskApp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 第三方应用包名</span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将应用添加到白名单<code>frameworks/base/core/res/res/values/config.xml</code>中添加</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lock_task_packages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>com.example.thirdpartyapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在<code>device\\rockchip\\rk356x\\rk3566_tspi\\rk3566_tspi.mk</code>中添加属性<code>persist.sys.def_launherpag</code><strong>rk3566_tspi.mk</strong></li></ol><div class="language-mk line-numbers-mode" data-ext="mk"><pre class="language-mk"><code>PRODUCT_PROPERTY_OVERRIDES += persist.sys.def_launherpag=dji.go.v5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>添加应用到<code>device\\rockchip\\rk356x\\rk3566_tspi\\preinstall\\</code> ,我就直接把应用<code>DJIFly.apk</code>丢进<code>preinstall</code>中</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DJIFly
 |-- DJIFly.apk
 |-- Android.mk
 |-- lib
Android.mk
preinstall.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android.mk</strong></p><div class="language-Android.mk line-numbers-mode" data-ext="Android.mk"><pre class="language-Android.mk"><code>include $(call all-subdir-makefiles)


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>preinstall.mk</strong></p><div class="language-preinstall.mk line-numbers-mode" data-ext="preinstall.mk"><pre class="language-preinstall.mk"><code>PRODUCT_PACKAGES += DJIFly

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>修改底部导航栏功能并隐藏</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><h3 id="编译结果-5" tabindex="-1"><a class="header-anchor" href="#编译结果-5" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0117v3" tabindex="-1"><a class="header-anchor" href="#_0117v3" aria-hidden="true">#</a> 0117v3</h2><h3 id="修改内容-6" tabindex="-1"><a class="header-anchor" href="#修改内容-6" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加启动代码到<code>frameworks/base/services/java/com/android/server/SystemServer.java</code>的<code>startOtherServices()</code>方法中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line 43</span>
<span class="token comment">// ilee modify here 1 line</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">BroadcastReceiver</span></span><span class="token punctuation">;</span>

<span class="token comment">// 系统服务启动完成后，添加以下代码</span>
<span class="token comment">// line:2247</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>

<span class="token comment">// line 2497</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">startKioskApp</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startKioskApp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// kiosk mode</span>
    <span class="token class-name">ActivityOptions</span> options <span class="token operator">=</span> <span class="token class-name">ActivityOptions</span><span class="token punctuation">.</span><span class="token function">makeBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    options<span class="token punctuation">.</span><span class="token function">setLockTaskEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 第三方应用包名</span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// modify to kiosk bundle</span>
        context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token function">toBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将应用添加到白名单<code>frameworks/base/core/res/res/values/config.xml</code>中添加</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lock_task_packages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>com.example.thirdpartyapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在<code>device\\rockchip\\rk356x\\rk3566_tspi\\rk3566_tspi.mk</code>中添加属性<code>persist.sys.def_launherpag</code><strong>rk3566_tspi.mk</strong></li></ol><div class="language-mk line-numbers-mode" data-ext="mk"><pre class="language-mk"><code>PRODUCT_PROPERTY_OVERRIDES += persist.sys.def_launherpag=dji.go.v5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>添加应用到<code>device\\rockchip\\rk356x\\rk3566_tspi\\preinstall\\</code> ,我就直接把应用<code>DJIFly.apk</code>丢进<code>preinstall</code>中</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DJIFly
 |-- DJIFly.apk
 |-- Android.mk
 |-- lib
Android.mk
preinstall.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android.mk</strong></p><div class="language-Android.mk line-numbers-mode" data-ext="Android.mk"><pre class="language-Android.mk"><code>include $(call all-subdir-makefiles)


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>preinstall.mk</strong></p><div class="language-preinstall.mk line-numbers-mode" data-ext="preinstall.mk"><pre class="language-preinstall.mk"><code>PRODUCT_PACKAGES += DJIFly

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>修改底部导航栏功能并隐藏</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div><h3 id="编译结果-6" tabindex="-1"><a class="header-anchor" href="#编译结果-6" aria-hidden="true">#</a> 编译结果</h3><p>刷入固件，反复重启</p><h2 id="_0117v4" tabindex="-1"><a class="header-anchor" href="#_0117v4" aria-hidden="true">#</a> 0117v4</h2><ol><li>内置应用 work</li><li>自启动 work</li><li>logo修改</li><li>导航栏隐藏</li></ol><h3 id="修改内容-7" tabindex="-1"><a class="header-anchor" href="#修改内容-7" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加启动代码到<code>frameworks/base/services/java/com/android/server/SystemServer.java</code>的<code>startOtherServices()</code>方法中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line 43</span>
<span class="token comment">// ilee modify here 1 line</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">BroadcastReceiver</span></span><span class="token punctuation">;</span>

<span class="token comment">// 系统服务启动完成后，添加以下代码</span>
<span class="token comment">// line:2247</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>

<span class="token comment">// line 2497</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">startKioskApp</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startKioskApp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);</span>
        <span class="token comment">// boolean isInLockTask = am.getLockTaskModeState() != ActivityManager.LOCK_TASK_MODE_NONE;</span>
        <span class="token comment">// if (!isInLockTask) {</span>
        <span class="token comment">//     startLockTask();</span>
        <span class="token comment">// }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将应用添加到白名单<code>frameworks/base/core/res/res/values/config.xml</code>中添加</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lock_task_packages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>com.example.thirdpartyapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在<code>device\\rockchip\\rk356x\\rk3566_tspi\\rk3566_tspi.mk</code>中添加属性<code>persist.sys.def_launherpag</code><strong>rk3566_tspi.mk</strong></li></ol><div class="language-mk line-numbers-mode" data-ext="mk"><pre class="language-mk"><code>PRODUCT_PROPERTY_OVERRIDES += persist.sys.def_launherpag=dji.go.v5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>添加应用到<code>device\\rockchip\\rk356x\\rk3566_tspi\\preinstall\\</code> ,我就直接把应用<code>DJIFly.apk</code>丢进<code>preinstall</code>中</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DJIFly
 |-- DJIFly.apk
 |-- Android.mk
 |-- lib
Android.mk
preinstall.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android.mk</strong></p><div class="language-Android.mk line-numbers-mode" data-ext="Android.mk"><pre class="language-Android.mk"><code>include $(call all-subdir-makefiles)


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>preinstall.mk</strong></p><div class="language-preinstall.mk line-numbers-mode" data-ext="preinstall.mk"><pre class="language-preinstall.mk"><code>PRODUCT_PACKAGES += DJIFly

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>修改底部导航栏功能并隐藏 <strong>取消功能</strong> 修改位于<code>frameworks/base/services/core/java/com/android/server/policy</code>的<code>PhoneWindowManager.java</code>文件</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_BACK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_HOME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_APP_SWITCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>隐藏导航栏</strong> 修改位于<code>frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/phone</code>的<code>NavigationBarView.java</code>文件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line:1213</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_UI_FLAG_HIDE_NAVIGATION</span> <span class="token operator">|</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_UI_FLAG_IMMERSIVE_STICKY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译结果-7" tabindex="-1"><a class="header-anchor" href="#编译结果-7" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0117v4-1" tabindex="-1"><a class="header-anchor" href="#_0117v4-1" aria-hidden="true">#</a> 0117v4</h2><ol><li>内置应用 work</li><li>自启动 work</li><li>logo修改</li><li>导航栏隐藏</li></ol><h3 id="修改内容-8" tabindex="-1"><a class="header-anchor" href="#修改内容-8" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加启动代码到<code>frameworks/base/services/java/com/android/server/SystemServer.java</code>的<code>startOtherServices()</code>方法中</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line 43</span>
<span class="token comment">// ilee modify here 1 line</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">BroadcastReceiver</span></span><span class="token punctuation">;</span>

<span class="token comment">// 系统服务启动完成后，添加以下代码</span>
<span class="token comment">// line:2247</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>

<span class="token comment">// line 2497</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">registerBootCompletedReceiver</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_BOOT_COMPLETED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">startKioskApp</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startKioskApp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> kioskPackage <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLaunchIntentForPackage</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// kiosk start</span>
        <span class="token keyword">int</span> taskId <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">ActivityManager</span> am <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ActivityManager</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">ACTIVITY_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActivityManager<span class="token punctuation">.</span>AppTask</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> am<span class="token punctuation">.</span><span class="token function">getAppTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tasks <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ActivityManager<span class="token punctuation">.</span>AppTask</span> task <span class="token operator">:</span> tasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTaskInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>topActivity <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> task<span class="token punctuation">.</span><span class="token function">getTaskInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>topActivity<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>kioskPackage<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    taskId <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getTaskInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>taskId<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">ActivityTaskManager</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startSystemLockTaskMode</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// kiosk end</span>
    <span class="token comment">//            boolean isInLockTask = am.getLockTaskModeState() != ActivityManager.LOCK_TASK_MODE_NONE;</span>
    <span class="token comment">//            if (!isInLockTask) {</span>
    <span class="token comment">//                startLockTask();</span>
    <span class="token comment">//            }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将应用添加到白名单<code>frameworks/base/core/res/res/values/config.xml</code>中添加</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string-array</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lock_task_packages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span><span class="token punctuation">&gt;</span></span>com.example.thirdpartyapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string-array</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>在<code>device\\rockchip\\rk356x\\rk3566_tspi\\rk3566_tspi.mk</code>中添加属性<code>persist.sys.def_launherpag</code><strong>rk3566_tspi.mk</strong></li></ol><div class="language-mk line-numbers-mode" data-ext="mk"><pre class="language-mk"><code>PRODUCT_PROPERTY_OVERRIDES += persist.sys.def_launherpag=dji.go.v5

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>添加应用到<code>device\\rockchip\\rk356x\\rk3566_tspi\\preinstall\\</code> ,我就直接把应用<code>DJIFly.apk</code>丢进<code>preinstall</code>中</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DJIFly
 |-- DJIFly.apk
 |-- Android.mk
 |-- lib
Android.mk
preinstall.mk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Android.mk</strong></p><div class="language-Android.mk line-numbers-mode" data-ext="Android.mk"><pre class="language-Android.mk"><code>include $(call all-subdir-makefiles)


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>preinstall.mk</strong></p><div class="language-preinstall.mk line-numbers-mode" data-ext="preinstall.mk"><pre class="language-preinstall.mk"><code>PRODUCT_PACKAGES += DJIFly

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>修改底部导航栏功能并隐藏 <strong>取消功能</strong> 修改位于<code>frameworks/base/services/core/java/com/android/server/policy</code>的<code>PhoneWindowManager.java</code>文件</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ilee modify here --start</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_BACK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_HOME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_APP_SWITCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>隐藏导航栏</strong> 修改位于<code>frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/phone</code>的<code>NavigationBarView.java</code>文件</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line:1213</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token function">setSystemUiVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_UI_FLAG_HIDE_NAVIGATION</span> <span class="token operator">|</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_UI_FLAG_IMMERSIVE_STICKY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译结果-8" tabindex="-1"><a class="header-anchor" href="#编译结果-8" aria-hidden="true">#</a> 编译结果</h3><ol><li>修改来自<code>frameworks/base/packages/SystemUI/src/com/android/systemui</code>的<code>SystemUIApplication.java</code>文件 暴力开启</li><li>修改来自<code>frameworks\\base\\services\\core\\java\\com\\android\\server\\am</code>的<code>ActivityManagerService.java</code>文件</li></ol><h2 id="_0120v1" tabindex="-1"><a class="header-anchor" href="#_0120v1" aria-hidden="true">#</a> 0120v1</h2><h3 id="修改内容-9" tabindex="-1"><a class="header-anchor" href="#修改内容-9" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加代码到<code>frameworks/base/services/core/java/com/android/server/wm</code>中的<code>ActivityTaskManagerService.java</code>文件中的<code>getHomeIntent</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 5870</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token class-name">Settings<span class="token punctuation">.</span>Global</span><span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Settings<span class="token punctuation">.</span>Global</span><span class="token punctuation">.</span><span class="token constant">DEVICE_PROVISIONED</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Settings<span class="token punctuation">.</span>Secure</span><span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Settings<span class="token punctuation">.</span>Secure</span><span class="token punctuation">.</span><span class="token constant">USER_SETUP_COMPLETE</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> defStartPkg <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> queryIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">PackageManager</span> mPm <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queryIntent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">CATEGORY_LAUNCHER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queryIntent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MAIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResolveInfo</span><span class="token punctuation">&gt;</span></span> homeActivities <span class="token operator">=</span> mPm<span class="token punctuation">.</span><span class="token function">queryIntentActivities</span><span class="token punctuation">(</span>queryIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>homeActivities <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> activityNum <span class="token operator">=</span> homeActivities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ComponentName</span><span class="token punctuation">[</span><span class="token punctuation">]</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">[</span>activityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> activityNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResolveInfo</span> info <span class="token operator">=</span> homeActivities<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">,</span> info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>defStartPkg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Intent</span> intentaa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>mTopAction<span class="token punctuation">,</span> mTopData <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>mTopData<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intentaa<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intentaa<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">CATEGORY_HOME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> intentaa<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译结果-9" tabindex="-1"><a class="header-anchor" href="#编译结果-9" aria-hidden="true">#</a> 编译结果</h3><h2 id="_0120v2" tabindex="-1"><a class="header-anchor" href="#_0120v2" aria-hidden="true">#</a> 0120v2</h2><h3 id="修改内容-10" tabindex="-1"><a class="header-anchor" href="#修改内容-10" aria-hidden="true">#</a> 修改内容</h3><ol><li>==0120v1</li><li>修改来自<code>frameworks/base/core/java/android/app/StatusBarManager.java</code>的<code>disable</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 233</span>
<span class="token comment">// ilee modify here 1 line</span>
what <span class="token operator">=</span> what <span class="token operator">|</span> <span class="token constant">DISABLE_EXPAND</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><code>frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/phone/PhoneStatusBarView.java</code>的<code>onTouchEvent</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//line: 224</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token comment">// return barConsumedEvent || super.onTouchEvent(event);</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>修改底部导航栏功能 <strong>取消功能</strong> 修改位于<code>frameworks/base/services/core/java/com/android/server/policy</code>的<code>PhoneWindowManager.java</code>文件</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 2673</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_BACK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_HOME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_APP_SWITCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//        if (keyCode == KeyEvent.KEYCODE_RECENT_APPS) {</span>
<span class="token comment">//            return -1;</span>
<span class="token comment">//        }</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_IN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_OUT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_NEXT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_PREVIOUS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译结果-10" tabindex="-1"><a class="header-anchor" href="#编译结果-10" aria-hidden="true">#</a> 编译结果</h3><p>开机自启 仍然可以使用近期应用界面 下拉栏无法使用 返回键和HOME键也无法使用</p><h3 id="添加" tabindex="-1"><a class="header-anchor" href="#添加" aria-hidden="true">#</a> 添加</h3><h4 id="设置特定包为默认启动应用" tabindex="-1"><a class="header-anchor" href="#设置特定包为默认启动应用" aria-hidden="true">#</a> 设置特定包为默认启动应用</h4><h3 id="修改内容-11" tabindex="-1"><a class="header-anchor" href="#修改内容-11" aria-hidden="true">#</a> 修改内容</h3><ol><li>添加代码到<code>frameworks/base/services/core/java/com/android/server/wm</code>中的<code>ActivityTaskManagerService.java</code>文件中的<code>getHomeIntent</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 5870</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token class-name">Settings<span class="token punctuation">.</span>Global</span><span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Settings<span class="token punctuation">.</span>Global</span><span class="token punctuation">.</span><span class="token constant">DEVICE_PROVISIONED</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Settings<span class="token punctuation">.</span>Secure</span><span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>mContext<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Settings<span class="token punctuation">.</span>Secure</span><span class="token punctuation">.</span><span class="token constant">USER_SETUP_COMPLETE</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> defStartPkg <span class="token operator">=</span> <span class="token string">&quot;dji.go.v5&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> queryIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">PackageManager</span> mPm <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queryIntent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">CATEGORY_LAUNCHER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queryIntent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_MAIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResolveInfo</span><span class="token punctuation">&gt;</span></span> homeActivities <span class="token operator">=</span> mPm<span class="token punctuation">.</span><span class="token function">queryIntentActivities</span><span class="token punctuation">(</span>queryIntent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>homeActivities <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> activityNum <span class="token operator">=</span> homeActivities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ComponentName</span><span class="token punctuation">[</span><span class="token punctuation">]</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">[</span>activityNum<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> activityNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResolveInfo</span> info <span class="token operator">=</span> homeActivities<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        set<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">,</span> info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>defStartPkg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>activityInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Intent</span> intentaa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>mTopAction<span class="token punctuation">,</span> mTopData <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>mTopData<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intentaa<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intentaa<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">CATEGORY_HOME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> intentaa<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="取消绘制底部按钮" tabindex="-1"><a class="header-anchor" href="#取消绘制底部按钮" aria-hidden="true">#</a> 取消绘制底部按钮</h4><ol><li>修改<code>frameworks/base/core/res/res/values/dimens.xml</code></li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token comment">&lt;!--    ilee modify here start  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dimen</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigation_bar_height<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0dp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dimen</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Height of the bottom navigation bar in portrait; often the same as @dimen/navigation_bar_height --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dimen</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigation_bar_height_landscape<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0dp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dimen</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--    ilee modify here end  --&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>修改<code>frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationHandle.java</code></li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 81</span>
<span class="token comment">// ilee modify here 1 line</span>
<span class="token comment">// canvas.drawRoundRect(0, y, width, y + height, mRadius, mRadius, mPaint);</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>修改底部导航栏功能 <strong>取消功能</strong> 修改位于<code>frameworks/base/services/core/java/com/android/server/policy</code>的<code>PhoneWindowManager.java</code>文件</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 2673</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_BACK</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_HOME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_APP_SWITCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//        if (keyCode == KeyEvent.KEYCODE_RECENT_APPS) {</span>
<span class="token comment">//            return -1;</span>
<span class="token comment">//        }</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_MENU</span>
        <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_ALL_APPS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_IN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_OUT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_NEXT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_NAVIGATE_PREVIOUS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加-1" tabindex="-1"><a class="header-anchor" href="#添加-1" aria-hidden="true">#</a> 添加</h3><h4 id="修改-logo" tabindex="-1"><a class="header-anchor" href="#修改-logo" aria-hidden="true">#</a> 修改 Logo</h4><p><strong>安卓开机Logo</strong></p><ol><li>修改<code>frameworks/base/core/res/assets/images</code>内的<code>android-logo-mask.png</code>文件 <strong>主板logo</strong></li><li>修改<code>kernel</code>内的<code>logo.bmp</code>以及<code>logo_kernel.bmp</code>文件</li></ol><h3 id="添加-2" tabindex="-1"><a class="header-anchor" href="#添加-2" aria-hidden="true">#</a> 添加</h3><h4 id="去掉开机-正在启动弹窗" tabindex="-1"><a class="header-anchor" href="#去掉开机-正在启动弹窗" aria-hidden="true">#</a> 去掉开机 正在启动弹窗</h4><ol><li>修改<code>frameworks/base/services/core/java/com/android/server/wm/WindowManagerService.java</code>中的<code>performEnableScreen</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 3453</span>
<span class="token comment">// ilee modify here --start</span>
<span class="token comment">/* if (!mBootAnimationStopped) {
    Trace.asyncTraceBegin(TRACE_TAG_WINDOW_MANAGER, &quot;Stop bootanim&quot;, 0);
    // stop boot animation
    // formerly we would just kill the process, but we now ask it to exit so it
    // can choose where to stop the animation.
    SystemProperties.set(&quot;service.bootanim.exit&quot;, &quot;1&quot;);
    mBootAnimationStopped = true;
}

if (!mForceDisplayEnabled &amp;&amp; !checkBootAnimationCompleteLocked()) {
    ProtoLog.i(WM_DEBUG_BOOT, &quot;performEnableScreen: Waiting for anim complete&quot;);
    return;
}

try {
    IBinder surfaceFlinger = ServiceManager.getService(&quot;SurfaceFlinger&quot;);
    if (surfaceFlinger != null) {
        ProtoLog.i(WM_ERROR, &quot;******* TELLING SURFACE FLINGER WE ARE BOOTED!&quot;);
        Parcel data = Parcel.obtain();
        data.writeInterfaceToken(&quot;android.ui.ISurfaceComposer&quot;);
        surfaceFlinger.transact(IBinder.FIRST_CALL_TRANSACTION, // BOOT_FINISHED
                data, null, 0);
        data.recycle();
    }
} catch (RemoteException ex) {
    ProtoLog.e(WM_ERROR, &quot;Boot completed: SurfaceFlinger is dead!&quot;);
} */</span>
<span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>修改<code>frameworks/base/services/core/java/com/android/server/wm/ActivityRecord.java</code>中的<code>onWindowsDrawn</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 5413</span>
        <span class="token comment">// ilee modify here --start</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isHomeIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> shortComponentName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shortComponentName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;FallbackHome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SystemProperties</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;service.bootanim.exit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;ActivityRecord&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;real home.....&quot;</span> <span class="token operator">+</span> shortComponentName<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//SystemService.stop(&quot;bootanim&quot;);</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">IBinder</span> surfaceFlinger <span class="token operator">=</span> <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">&quot;SurfaceFlinger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>surfaceFlinger <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Slog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG_WM</span><span class="token punctuation">,</span> <span class="token string">&quot;******* TELLING SURFACE FLINGER WE ARE BOOTED!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Parcel</span> data <span class="token operator">=</span> <span class="token class-name">Parcel</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    data<span class="token punctuation">.</span><span class="token function">writeInterfaceToken</span><span class="token punctuation">(</span><span class="token string">&quot;android.ui.ISurfaceComposer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    surfaceFlinger<span class="token punctuation">.</span><span class="token function">transact</span><span class="token punctuation">(</span><span class="token class-name">IBinder</span><span class="token punctuation">.</span><span class="token constant">FIRST_CALL_TRANSACTION</span><span class="token punctuation">,</span> <span class="token comment">// BOOT_FINISHED</span>
                            data<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    data<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Slog</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG_WM</span><span class="token punctuation">,</span> <span class="token string">&quot;Boot completed: SurfaceFlinger is dead!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ilee modify here --end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>修改<code>packages/apps/Settings/src/com/android/settings/FallbackHome.java</code>中的<code>mProgressTimeoutRunnable</code>方法</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// line: 52</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Runnable</span> mProgressTimeoutRunnable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ilee modify here --start</span>
<span class="token comment">//        View v = getLayoutInflater().inflate(</span>
<span class="token comment">//                R.layout.fallback_home_finishing_boot, null /* root */);</span>
<span class="token comment">//        setContentView(v);</span>
<span class="token comment">//        v.setAlpha(0f);</span>
<span class="token comment">//        v.animate()</span>
<span class="token comment">//                .alpha(1f)</span>
<span class="token comment">//                .setDuration(500)</span>
<span class="token comment">//                .setInterpolator(AnimationUtils.loadInterpolator(</span>
<span class="token comment">//                        this, android.R.interpolator.fast_out_slow_in))</span>
<span class="token comment">//                .start();</span>
        <span class="token comment">// ilee modify here --end</span>
        <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">LayoutParams</span><span class="token punctuation">.</span><span class="token constant">FLAG_KEEP_SCREEN_ON</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="默认手势导航" tabindex="-1"><a class="header-anchor" href="#默认手势导航" aria-hidden="true">#</a> 默认手势导航</h4><ol><li>修改<code>frameworks/base/core/res/res/values/config.xml</code>文件</li></ol><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token comment">&lt;!-- Controls the navigation bar interaction mode:
         0: 3 button mode (back, home, overview buttons)
         1: 2 button mode (back, home buttons + swipe up for overview)
         2: gestures only for back, home and overview --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>integer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config_navBarInteractionMode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>integer</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2>`,171),r={href:"https://blog.csdn.net/u010823818/article/details/144415966?fromshare=blogdetail&sharetype=blogdetail&sharerId=144415966&sharerefer=PC&sharesource=weixin_50843001&sharefrom=from_link",target:"_blank",rel:"noopener noreferrer"},d={href:"https://blog.csdn.net/youthking1314/article/details/128393909?fromshare=blogdetail&sharetype=blogdetail&sharerId=128393909&sharerefer=PC&sharesource=weixin_50843001&sharefrom=from_link",target:"_blank",rel:"noopener noreferrer"},k={href:"https://blog.csdn.net/HuanWen_Cheng/article/details/141065714?fromshare=blogdetail&sharetype=blogdetail&sharerId=141065714&sharerefer=PC&sharesource=weixin_50843001&sharefrom=from_link",target:"_blank",rel:"noopener noreferrer"},v={href:"https://www.jianshu.com/p/fafff8d985a3",target:"_blank",rel:"noopener noreferrer"},m={href:"https://www.cnblogs.com/topeet/p/18560526",target:"_blank",rel:"noopener noreferrer"},b={href:"https://blog.csdn.net/a546036242/article/details/121992823",target:"_blank",rel:"noopener noreferrer"},g={href:"https://blog.csdn.net/jingzhemodao/article/details/131088784",target:"_blank",rel:"noopener noreferrer"},h={href:"https://developer.aliyun.com/article/1196768",target:"_blank",rel:"noopener noreferrer"},f={href:"https://blog.csdn.net/hedalei/article/details/140021960",target:"_blank",rel:"noopener noreferrer"},y={href:"https://www.60if.com/361.html",target:"_blank",rel:"noopener noreferrer"},w={href:"https://www.cnblogs.com/guanxinjing/p/17969803",target:"_blank",rel:"noopener noreferrer"},_={href:"https://blog.csdn.net/qq_37858386/article/details/120365883",target:"_blank",rel:"noopener noreferrer"},I={href:"https://blog.csdn.net/TQ_wangbin/article/details/135132729?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-135132729-blog-124710885.235%5Ev43%5Epc_blog_bottom_relevance_base9&spm=1001.2101.3001.4242.2&utm_relevant_index=4",target:"_blank",rel:"noopener noreferrer"},x={href:"https://mbb.eet-china.com/blog/4098392-461673.html",target:"_blank",rel:"noopener noreferrer"},E={href:"https://blog.csdn.net/TQ_wangbin/article/details/135132729?fromshare=blogdetail&sharetype=blogdetail&sharerId=135132729&sharerefer=PC&sharesource=weixin_50843001&sharefrom=from_link",target:"_blank",rel:"noopener noreferrer"},A=n("li",null,[n("a",{href:""})],-1);function C(S,T){const a=o("ExternalLinkIcon");return p(),i("div",null,[u,n("ol",null,[n("li",null,[s("开机自启动 "),n("ul",null,[n("li",null,[n("a",r,[s("默认Launcher（全网最全、任意Android版本、任意应用）"),e(a)])]),n("li",null,[n("a",d,[s("开机直接进入该应用作为默认launcher（霸屏）或者开机自启指定应用"),e(a)])])])]),n("li",null,[s("应用内置 "),n("ul",null,[n("li",null,[n("a",k,[s("RK平台如何 将第三方资源文件和代码编译到系统内"),e(a)])]),n("li",null,[n("a",v,[s("【RK3568】Android 11预装（内置）应用到系统中"),e(a)])]),n("li",null,[n("a",m,[s("基于迅为RK3568开发板全国产平台，快速实现APP开机自启动技术分享"),e(a)])]),n("li",null,[n("a",b,[s("Android 10 RK 集成第三方apk"),e(a)])])])]),n("li",null,[s("取消导航栏功能 "),n("ul",null,[n("li",null,[n("a",g,[s("android11源码去掉底部虚拟按钮导航"),e(a)])]),n("li",null,[n("a",h,[s("Android6.0 源码修改之屏蔽导航栏虚拟按键（Home和RecentAPP）/动态显示和隐藏NavigationBar"),e(a)])]),n("li",null,[n("a",f,[s("Android11以上系统实现app霸屏的一种设置"),e(a)])]),n("li",null,[n("a",y,[s("Android KeyEvent 按键事件"),e(a)])])])]),n("li",null,[s("取消下拉栏 "),n("ul",null,[n("li",null,[n("a",w,[s("Android系统开发 禁止状态栏下拉功能"),e(a)])])])]),n("li",null,[s("修改Android开机logo "),n("ul",null,[n("li",null,[n("a",_,[s("2021-09-18 Android 开机logo修改和简单代码分析"),e(a)])])])]),n("li",null,[s("修改开机屏幕中心弹窗 "),n("ul",null,[n("li",null,[n("a",I,[s("方法|rk3568开发平台如何去除android正在启动弹窗"),e(a)])]),n("li",null,[n("a",x,[s("RK3566RK3568开发板Android11屏蔽开机启动提示，优化启动时间"),e(a)])])])]),n("li",null,[s("消除消息提示弹窗 "),n("ul",null,[n("li",null,[n("a",E,[s("方法|rk3568开发平台如何去除android正在启动弹窗"),e(a)]),s(" 貌似一并解决了")]),A])])])])}const q=t(l,[["render",C],["__file","android-rk356x.html.vue"]]);export{q as default};
